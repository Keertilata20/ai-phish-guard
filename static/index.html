<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Phish Guard</title>
 <link rel="stylesheet" href="/static/style.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body>

<div class="container">

    <h1>üõ°Ô∏è AI Phish Guard</h1>
    <p class="tagline">Detecting deception before it detects you</p>

    <div class="input-group">
        <input type="text" id="urlInput" placeholder="Enter suspicious link...">
        <button id="scanBtn" onclick="scanURL()">Scan Now</button>
    </div>

    <p id="scanStatus"></p>

    <!-- RESULT BOX -->
    <div id="resultBox" class="result-box hidden">
        <h2 id="resultText"></h2>
        <div class="risk-bar">
            <div id="riskFill"></div>
        </div>
        <p id="riskPercent"></p>
    </div>

    <!-- TIMELINE -->
    <div id="scanTimeline" class="timeline hidden">
        <div class="timeline-step" id="t1">üîê Initializing shield...</div>
        <div class="timeline-step" id="t2">üåê Expanding short link...</div>
        <div class="timeline-step" id="t3">üß† AI analysing behaviour...</div>
        <div class="timeline-step" id="t4">‚ö†Ô∏è Risk modeling...</div>
    </div>

    <!-- EXPANDED LINK -->
    <div id="expandedBox" class="expanded hidden">
        <strong>Expanded Link:</strong>
        <p id="expandedLink">Checking...</p>
    </div>

    <!-- CONFIDENCE -->
    <div id="confidenceBox" class="confidence hidden">

        <h3>Confidence Breakdown</h3>

        <div class="bar">
            <span>Structure Risk</span>
            <div class="fill" id="structBar"></div>
        </div>

        <div class="bar">
            <span>Domain Risk</span>
            <div class="fill" id="domainBar"></div>
        </div>

        <div class="bar">
            <span>Behaviour Risk</span>
            <div class="fill" id="aiBar"></div>
        </div>

    </div>

</div>

<script>

async function scanURL() {

    const btn = document.getElementById("scanBtn");
    const status = document.getElementById("scanStatus");
    const resultBox = document.getElementById("resultBox");

    btn.disabled = true;
    btn.innerText = "Scanning...";
    resultBox.classList.add("hidden");

    document.getElementById("scanTimeline").classList.remove("hidden");

    let steps = ["t1","t2","t3","t4"];

    for(let id of steps){
        document.getElementById(id).classList.add("active");
        await new Promise(r => setTimeout(r,600));
    }

    const url = document.getElementById("urlInput").value;

    const response = await fetch("/scan", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({url})
    });

    const data = await response.json();

    resultBox.classList.remove("hidden");

    let risk = Math.round((data.confidence || data.probability || 0) * 100);

    const resultText = document.getElementById("resultText");
    const riskFill = document.getElementById("riskFill");
    const riskPercent = document.getElementById("riskPercent");

    if(data.label === "safe"){
        resultText.innerText = "‚úî Safe";
        resultBox.className = "result-box safe";
    }
    else if(data.label === "suspicious"){
        resultText.innerText = "‚ö† Suspicious";
        resultBox.className = "result-box suspicious";
    }
    else{
        resultText.innerText = "üö® Phishing Detected";
        resultBox.className = "result-box danger";
    }

    riskFill.style.width = risk + "%";
    riskPercent.innerText = risk + "% risk";

    // Expanded Link
    document.getElementById("expandedBox").classList.remove("hidden");
    document.getElementById("expandedLink").innerText = data.expanded_url || "Original link";

    // Confidence
    document.getElementById("confidenceBox").classList.remove("hidden");

    let base = (data.confidence || 0.5) * 100;

document.getElementById("structBar").style.width = (base * 0.7) + "%";
document.getElementById("domainBar").style.width = (base * 0.9) + "%";
document.getElementById("aiBar").style.width = base + "%";
    btn.disabled = false;
    btn.innerText = "Scan Now";
}

</script>

</body>
</html>